<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>3D Home Configurator with Pricing</title>
<link rel="stylesheet" href="css/styles.css?v=20251006-1">
</head>
<body>

<div id="controls">
		<button onclick="addNewRoom()">+ Add Room</button>
        <!-- Render button removed -->
	<select id="levelSelect" onchange="switchLevel()">
		<option value="0">Ground Floor</option>
		<option value="1">First Floor</option>
		<option value="stairs">Add Stairs</option>
		<option value="pergola">Add Pergola</option>
		<option value="garage">Add Garage</option>
		<option value="roof">Add Roof</option>
		<option value="balcony">Add Balcony</option>
	</select>
	<button class="secondary" onclick="resetAll()">Reset</button>
	<button class="secondary" onclick="showPricing()" title="Show pricing">ðŸ’° Price</button>
	<button class="secondary" onclick="showInfo()" title="Show information">â„¹</button>
	<select id="actionsMenu" title="Actions Menu">
		<option value="" selected disabled>â˜° Menu</option>
		<option value="obj">â¬‡ 3D - OBJ</option>
		<option value="obj-upload">â¬† 3D - OBJ</option>
		<option value="pdf">ðŸ“„ PDF (Export Views)</option>
		<option value="pdf-floorplan-upload">â¬† Floorplan (PDF)</option>
		<option value="json-download">â¬‡ JSON</option>
		<option value="json-upload">â¬† JSON</option>
		<option disabled>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</option>
	</select>
</div>

<canvas id="canvas" width="1200" height="800" style="border:1px solid #ccc; background:#f8fbff; display:block; margin:20px auto;"></canvas>
<div id="labels"></div>
<div id="status">Ready</div>

<div id="measurements">
	<h3>Object Measurements</h3>
	<div class="measurement-item">
		<span class="measurement-label">Name:</span>
		<input class="measurement-input" id="input-name" type="text" maxlength="60" />
	</div>
	<div class="measurement-item">
		<span class="measurement-label">Width (X):</span>
		<input class="measurement-input" id="input-width" type="number" step="0.1" min="1" max="40" />
	</div>
	<div class="measurement-item">
		<span class="measurement-label">Depth (Z):</span>
		<input class="measurement-input" id="input-depth" type="number" step="0.1" min="1" max="40" />
	</div>
	<div class="measurement-item">
		<span class="measurement-label">Height (Y):</span>
		<input class="measurement-input" id="input-height" type="number" step="0.1" min="0.5" max="10" />
	</div>
	<div class="measurement-item">
		<span class="measurement-label">Position X:</span>
		<input class="measurement-input" id="input-pos-x" type="number" step="0.1" min="-100" max="100" />
	</div>
	<div class="measurement-item">
		<span class="measurement-label">Position Z:</span>
		<input class="measurement-input" id="input-pos-z" type="number" step="0.1" min="-100" max="100" />
	</div>
	<div class="measurement-item">
		<span class="measurement-label">Floor:</span>
		<span class="measurement-value" id="measure-floor">--</span>
	</div>
	<button id="save-measurements" style="margin-top:10px;padding:6px 16px;">Save</button>
</div>

<!-- Room palette modal for adding furniture -->
<div id="room-palette-modal" style="display:none;">
	<div id="room-palette-content">
		<button class="close-button" onclick="hideRoomPalette()">&times;</button>
		<div id="room-palette-left">
			<h3 id="room-palette-title">Room</h3>
			<canvas id="room-preview-canvas" width="360" height="260"></canvas>
		</div>
		<div id="room-palette-right">
			<h3>Furniture List</h3>
			<div style="display:flex; gap:8px; align-items:center; justify-content:center; margin-bottom:8px;">
				<button class="secondary" id="palette-clear" title="Clear preview items">Clear</button>
				<button id="palette-commit" title="Add preview items to room">Add to Room</button>
			</div>
			<div id="palette-list"></div>
		</div>
	</div>
	<div id="room-palette-backdrop" onclick="hideRoomPalette()"></div>
	</div>

<div id="info-modal">
	<div id="info-content">
		<button class="close-button" onclick="hideInfo()">&times;</button>
		<h2>3D Home Configurator</h2>
		<p><strong>Camera Controls:</strong></p>
		<ul>
			<li>Drag to rotate view</li>
			<li>Shift + Drag to pan</li>
			<li>Mouse wheel to zoom in/out</li>
		</ul>
		<p><strong>Building:</strong></p>
		<ul>
			<li>Click "+ Add Room" to create new rooms</li>
			<li>Use dropdown to add stairs, pergolas, garages, or roofs</li>
			<li>Click room labels to select and drag objects</li>
			<li>Drag colored handles to resize selected objects</li>
		</ul>
		<p><strong>Keyboard:</strong></p>
		<ul>
			<li>Escape - Clear selection</li>
			<li>Delete - Remove selected object</li>
		</ul>
	</div>
</div>

<input type="file" id="upload-file" accept="application/json" style="display:none" />
<input type="file" id="upload-obj-file" accept=".obj" style="display:none" />
<input type="file" id="upload-pdf-floorplan" accept="application/pdf" style="display:none" />

<!-- Floorplan Import Modal -->
<div id="floorplan-modal" style="display:none; position:fixed; inset:0; z-index:10000; align-items:center; justify-content:center;">
	<div id="floorplan-backdrop" style="position:absolute; inset:0; background:rgba(0,0,0,0.45);"></div>
	<div id="floorplan-content" style="position:relative; width: min(1200px, 95vw); height: calc(100vh - 40px); max-height:100vh; background:#fff; border-radius:12px; box-shadow:0 12px 40px rgba(0,0,0,0.25); display:flex; flex-direction:column; overflow:hidden;">
		<div style="display:flex; align-items:center; gap:8px; padding:10px 12px; border-bottom:1px solid #e5e7eb; background:#f8fafc;">
			<strong style="flex:1">Import Floorplan (PDF)</strong>
			<button id="floorplan-close" class="secondary" title="Close">âœ•</button>
		</div>
		<div style="display:flex; min-height:0; height:100%;">
			<div style="flex:1; position:relative; background:#0b1020; display:flex; align-items:stretch; justify-content:stretch;">
				<canvas id="floorplan-canvas" style="width:100%; height:100%; background:#0b1020; display:block;"></canvas>
				<canvas id="floorplan-overlay" style="position:absolute; inset:0; pointer-events:none;"></canvas>
			</div>
			<div style="width:280px; border-left:1px solid #e5e7eb; padding:10px; display:flex; flex-direction:column; gap:10px; background:#fff; overflow:auto;">
				<div style="display:flex; align-items:center; gap:6px;">
					<span style="font-size:12px; color:#374151;">Page</span>
					<button id="fp-page-prev" class="secondary" title="Previous page">â—€</button>
					<input id="fp-page-input" type="number" min="1" value="1" style="width:56px;" />
					<span style="font-size:12px; color:#374151;">/ <span id="fp-page-total">1</span></span>
					<button id="fp-page-next" class="secondary" title="Next page">â–¶</button>
				</div>
				<div>
					<div style="font-weight:600; margin-bottom:6px;">Steps</div>
					<ol style="margin:0 0 6px 18px; padding:0;">
						<li>Calibrate scale: click two points, enter real distance</li>
						<li>Draw rooms: drag to place rectangles</li>
						<li>Commit rooms to scene</li>
					</ol>
				</div>
				<div style="display:flex; gap:6px; flex-wrap:wrap;">
					<button id="fp-mode-calibrate">Calibrate</button>
					<button id="fp-mode-place">Place Room</button>
					<button id="fp-undo" class="secondary">Undo</button>
					<button id="fp-refine-detect" class="secondary" title="Re-run automatic detection">Refine Detect</button>
				</div>
				<div style="display:flex; flex-direction:column; gap:6px;">
					<label style="font-size:12px; color:#374151;">Real distance (m) for last two clicks</label>
					<input id="fp-real-distance" type="number" min="0.1" max="1000" step="0.1" value="1.0" />
					<button id="fp-apply-scale" class="secondary">Apply Scale</button>
				</div>
				<div style="display:flex; flex-direction:column; gap:4px; background:#f8fafc; padding:8px; border:1px solid #e5e7eb; border-radius:8px;">
					<div style="font-size:12px; font-weight:600; color:#1e293b; display:flex; align-items:center; gap:4px;">Auto Detection</div>
					<label style="font-size:11px; color:#475569; display:flex; flex-direction:column; gap:2px;">Min Room (m)
						<input id="fp-auto-min" type="number" step="0.5" min="1" value="2" style="width:100%; font-size:11px;" />
					</label>
					<label style="font-size:11px; color:#475569; display:flex; flex-direction:column; gap:2px;">Max Aspect Ratio
						<input id="fp-auto-ar" type="number" step="0.5" min="2" value="8" style="width:100%; font-size:11px;" />
					</label>
					<label style="font-size:11px; color:#475569; display:flex; flex-direction:column; gap:2px;">Border Ink â‰¥
						<input id="fp-auto-border" type="number" step="0.05" min="0" max="1" value="0.15" style="width:100%; font-size:11px;" />
					</label>
				</div>
				<div style="font-size:12px; color:#374151;">
					<div>Scale: <span id="fp-scale-display">â€”</span> px/m</div>
					<div>Rooms queued: <span id="fp-rooms-count">0</span></div>
				</div>
				<div style="margin-top:auto; display:flex; gap:8px;">
					<button id="fp-commit" style="flex:1;">Commit to Scene</button>
					<button id="fp-cancel" class="secondary">Cancel</button>
				</div>
			</div>
		</div>
	</div>
  
</div>

<div id="pricing-modal">
	<div id="pricing-content">
		<button class="close-button" onclick="hidePricing()">&times;</button>
		<h2>Project Pricing</h2>
		<div id="pricing-breakdown">
			<div class="pricing-section">
				<h3>Rooms</h3>
				<div id="room-pricing"></div>
			</div>
			<div class="pricing-section">
				<h3>Additional Components</h3>
				<div id="component-pricing"></div>
			</div>
			<div class="pricing-section total-section">
				<h3>Total Estimate</h3>
				<div id="total-pricing"></div>
			</div>
		</div>
	</div>
</div>

<!-- jsPDF for multi-page PDF export -->
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<!-- PDF.js for PDF floorplan import (vendored for offline use) -->
<script src="vendor/pdfjs/pdf.min.js"></script>
<script>
	if (window['pdfjsLib'] && (!pdfjsLib.GlobalWorkerOptions.workerSrc || pdfjsLib.GlobalWorkerOptions.workerSrc.indexOf('http') === 0)) {
		pdfjsLib.GlobalWorkerOptions.workerSrc = 'vendor/pdfjs/pdf.worker.min.js';
	}
	// If this fails, the app will lazy-load from CDN as a secondary fallback when importing
</script>
<script src="js/app.js?v=20251006-1"></script>

</body>
</html>
