  * { margin: 0; padding: 0; box-sizing: border-box; }
  html, body { height: 100%; overflow: hidden; font-family: system-ui, sans-serif; background:#ffffff; }
  
  #controls {
    position: fixed; top: 20px; left: 20px; z-index: 100;
    background: rgba(255,255,255,0.95); backdrop-filter: blur(10px);
    padding: 15px; border-radius: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    display: flex; gap: 12px; align-items: center;
  }

  /* Custom dropdown (forces white/black regardless of native UI) */
  .dropdown { position: relative; display: inline-block; }
  .dropdown-button {
    display: inline-flex; align-items: center; gap: 8px;
    position: relative; /* anchor absolute caret */
    background: #ffffff; color: #000000; border: 1px solid #ccc; border-radius: 6px;
    padding: 10px 34px 10px 12px; font-size: 14px; font-weight: 400; cursor: pointer;
    box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    transition: border-color 160ms ease, box-shadow 160ms ease, background-color 160ms ease, color 160ms ease;
  }
  .dropdown-button:hover { border-color: #b5b5b5; box-shadow: 0 3px 10px rgba(0,0,0,0.08); }
  .dropdown-button:focus { outline: none; border-color: #007acc; box-shadow: 0 0 0 3px rgba(0,122,204,0.18); }
  .dropdown-button .caret {
    position: absolute; right: 12px; width: 12px; height: 8px; pointer-events: none;
    top: 50%; transform: translateY(-50%); /* center arrow vertically */
    display: flex; align-items: center; justify-content: center;
  }
  .dropdown-button .caret svg { display: block; }

  /* 2D Plan floor toggle */
  .plan2d-floor-toggle { background:#e2e8f0; padding:4px; border-radius:999px; display:inline-flex; gap:4px; box-shadow: inset 0 1px 2px rgba(0,0,0,0.04); }
  .plan2d-floor-toggle button { border:none; background:#ffffff; color:#111827; font-weight:600; font-size:12px; padding:6px 12px; border-radius:999px; cursor:pointer; box-shadow: 0 1px 2px rgba(0,0,0,0.06); transition: background-color 0.2s, color 0.2s, box-shadow 0.2s; }
  .plan2d-floor-toggle button:hover {
    background: #007acc;
    color: #ffffff;
    box-shadow: 0 3px 12px rgba(0,122,204,0.35);
  }
  .plan2d-floor-toggle button.active { background:#007acc; color:#ffffff; box-shadow: 0 2px 8px rgba(0,122,204,0.35); }

  /* Remove thick focus keyline on the 2D Plan modal container while preserving keyboard focus */
  #plan2d-content { outline: none; }
  #plan2d-content:focus { outline: none !important; box-shadow: 0 22px 70px -8px rgba(0,0,0,0.55); }

  /* Match 2D Plan toolbar buttons to main navigation secondary button style */
  #plan2d-content button.secondary {
    background: #ffffff !important;
    color: #000000 !important;
    border: 1px solid #ccc !important;
    box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    font-weight: 400 !important;
  }
  /* Hover state matches dropdown rollover: brand blue background, white text */
  #plan2d-content button.secondary:hover {
    background-color: #007acc !important;
    color: #ffffff !important;
    border-color: #007acc !important;
    box-shadow: 0 3px 12px rgba(0,122,204,0.35) !important;
  }
  /* Active tool state: same as hover to signal selection */
  #plan2d-content button.secondary.active {
    background-color: #007acc !important;
    color: #ffffff !important;
    border-color: #007acc !important;
    box-shadow: 0 0 0 3px rgba(0,122,204,0.18) !important;
  }
  .dropdown-button .caret svg path { stroke: #333; }
  .dropdown.open .dropdown-button { border-color: #007acc; box-shadow: 0 0 0 3px rgba(0,122,204,0.12); }

  /* Main menu (actions) specific hover/open styles: white text on brand blue */
  #actionsDropdown .dropdown-button:hover {
    color: #ffffff !important;
    background-color: #007acc !important;
    border-color: #007acc !important;
    box-shadow: 0 3px 12px rgba(0,122,204,0.35) !important;
  }
  #actionsDropdown .dropdown-button:hover .caret svg path { stroke: #ffffff !important; }
  #actionsDropdown.open .dropdown-button {
    color: #ffffff !important;
    background-color: #007acc !important;
    border-color: #007acc !important;
    box-shadow: 0 0 0 3px rgba(0,122,204,0.18) !important;
  }
  #actionsDropdown.open .dropdown-button .caret svg path { stroke: #ffffff !important; }

  /* Level dropdown: same white-on-blue rollover/open behavior */
  #levelDropdown .dropdown-button:hover {
    color: #ffffff !important;
    background-color: #007acc !important;
    border-color: #007acc !important;
    box-shadow: 0 3px 12px rgba(0,122,204,0.35) !important;
  }
  #levelDropdown .dropdown-button:hover .caret svg path { stroke: #ffffff !important; }
  #levelDropdown.open .dropdown-button {
    color: #ffffff !important;
    background-color: #007acc !important;
    border-color: #007acc !important;
    box-shadow: 0 0 0 3px rgba(0,122,204,0.18) !important;
  }
  #levelDropdown.open .dropdown-button .caret svg path { stroke: #ffffff !important; }

  /* Roof type dropdown: white text on blue for rollover/open, and white text on hovered items */
  #roof-type-dropdown .dropdown-button:hover {
    color: #ffffff !important;
    background-color: #007acc !important;
    border-color: #007acc !important;
    box-shadow: 0 3px 12px rgba(0,122,204,0.35) !important;
  }
  #roof-type-dropdown .dropdown-button:hover .caret svg path { stroke: #ffffff !important; }
  #roof-type-dropdown.open .dropdown-button {
    color: #ffffff !important;
    background-color: #007acc !important;
    border-color: #007acc !important;
    box-shadow: 0 0 0 3px rgba(0,122,204,0.18) !important;
  }
  #roof-type-dropdown.open .dropdown-button .caret svg path { stroke: #ffffff !important; }
  /* Dropdown list item rollover: brand blue background with white text (scoped to roof dropdown only) */
  #roof-type-dropdown .dropdown-list .dropdown-item:hover {
    background-color: #007acc !important;
    color: #ffffff !important;
  }

  /* Main menu: make all secondary buttons white with black text (except primary Add Room) */
  #controls button.secondary {
    background: #ffffff !important;
    color: #000000 !important;
    border: 1px solid #ccc !important;
    box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    font-weight: 400 !important;
  }
  /* Hover state matches main menu rollover: brand blue background, white text */
  #controls button.secondary:hover {
    background-color: #007acc !important;
    color: #ffffff !important;
    border-color: #007acc !important;
    box-shadow: 0 3px 12px rgba(0,122,204,0.35) !important;
  }

  .dropdown-list {
    position: absolute; top: calc(100% + 6px); left: 0; min-width: 180px; max-height: 300px; overflow: auto;
    background: #ffffff; color: #000000; border: 1px solid #d1d5db; border-radius: 8px; box-shadow: 0 10px 24px rgba(0,0,0,0.14);
    padding: 6px 0; z-index: 200; display: none;
  }
  .dropdown.open .dropdown-list { display: block; }
  /* Actions menu: show full submenu without scrolling */
  #actionsDropdown .dropdown-list {
    max-height: none !important;
    overflow: visible !important;
  }
  .dropdown-item {
    padding: 8px 12px; font-size: 14px; cursor: pointer; white-space: nowrap; display: flex; align-items: center; gap: 8px;
  }
  .dropdown-item:hover { background: #f2f4f7; }
  .dropdown-item.disabled { color: #9aa0a6; cursor: default; }
  .dropdown-item.separator { padding: 4px 0; margin: 4px 0; border-top: 1px solid #e5e7eb; cursor: default; }
  .dropdown-title { font-size: 12px; font-weight: 700; color: #6b7280; padding: 6px 12px 4px 12px; text-transform: uppercase; letter-spacing: 0.04em; cursor: default; }
  
  button {
    padding: 10px 16px; border: none; border-radius: 6px; 
    background: #007acc; color: white; cursor: pointer; font-size: 14px; font-weight: 400;
    transition: background 0.2s, color 0.2s, border-color 0.2s, box-shadow 0.2s;
  }
  button:hover {
    background: #005999;
    box-shadow: 0 3px 12px rgba(0,122,204,0.35);
  }
  button.secondary { background: #f0f0f0; color: #333; border: 1px solid #ccc; }
  button.secondary:hover {
    background-color: #007acc !important;
    color: #ffffff !important;
    border-color: #007acc !important;
    box-shadow: 0 3px 12px rgba(0,122,204,0.35) !important;
  }
  
  select {
      padding: 10px 30px 10px 10px; /* extra right padding for arrow */
    border: 1px solid #ccc !important;
    border-radius: 6px !important;
    background-color: #ffffff !important;
    color: #000000 !important;
    font-size: 14px !important;
    appearance: none !important;
    -webkit-appearance: none !important;
    -moz-appearance: none !important;
      background-image: url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1L6 6L11 1' stroke='%23333' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 12px center;
    background-size: 12px 8px;
  transition: border-color 160ms ease, box-shadow 160ms ease, background-color 160ms ease, color 160ms ease !important;
    }

  /* Elegant rollover for dropdowns */
  select:hover {
    border-color: #b5b5b5 !important;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08) !important;
  }
  select:focus {
    outline: none !important;
    border-color: #007acc !important;
    box-shadow: 0 0 0 3px rgba(0,122,204,0.18) !important;
  }

  /* Ensure dropdown options also appear with white background and black text */
  select option {
    background-color: #ffffff !important;
    color: #000000 !important;
  }
  /* Optional: subtle hover and selected states for options (browser support varies) */
  select option:hover {
    background-color: #f2f4f7;
    color: #000000;
  }
  select option:checked {
    background-color: #e9f3fb;
    color: #000000;
  }

  /* Make sure the main actions menu is consistent */
  #actionsMenu, #levelSelect {
    background-color: #ffffff !important;
    color: #000000 !important;
    min-width: 150px;
  }
  
  #measurements {
    position: fixed; top: 20px; right: 20px; z-index: 100;
    background: rgba(255,255,255,0.95); backdrop-filter: blur(10px);
    padding: 15px; border-radius: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    min-width: 200px; width: 340px; font-family: monospace; font-size: 12px;
    display: block;
  }
  
  #measurements.visible { display: block; }
  
  #measurements h3 {
    margin: 0 0 10px 0; font-size: 14px; font-weight: 600; color: #333;
    text-align: center; font-family: system-ui, sans-serif;
  }
  
  #measurements .measurement-item {
    display: flex; justify-content: space-between; align-items: center; margin: 5px 0;
    padding: 3px 0; border-bottom: 1px solid #eee;
  }
  #measurements .measurement-label { min-width: 90px; }
  
  #measurements .measurement-label { color: #666; font-weight: 500; }
  #measurements .measurement-value { color: #333; font-weight: 600; }
  #measurements .measurement-input {
    width: 60px;
    font-family: monospace;
    font-size: 12px;
    color: #333;
    background: #fff;
    border: 1px solid #ccc;
    border-radius: 4px;
    padding: 2px 6px;
    margin-left: 8px;
    text-align: right;
  }

  /* Wider name input for better readability */
  #input-name.measurement-input {
    width: calc(100% - 90px - 8px);
    max-width: none;
    text-align: left;
    font-family: system-ui, sans-serif;
  }
  
  #status {
    position: fixed; bottom: 20px; right: 20px; z-index: 100;
    background: rgba(0,0,0,0.8); color: white; padding: 10px 15px;
    border-radius: 8px; font-family: monospace; font-size: 12px;
  }
  
  #canvas {
    position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
    background: #f8fbff; /* solid to remove perceived top keyline from gradient */
    cursor: grab; display: block; z-index: 1; /* ensure canvas sits above page background */
  }
  #canvas:active { cursor: grabbing; }
  
  #labels-3d {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    pointer-events: none; z-index: 50; /* container ignores events; labels handle them */
  }
  
  .room-label {
    position: absolute; transform: translate(-50%, -50%);
    pointer-events: all; cursor: grab; user-select: none;
    background: white; color: #333;
    padding: 6px 11px; border-radius: 19px; font-weight: 600; font-size: 10px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    /* Let JS-driven per-frame opacity control handle smoothness; avoid extra CSS lag */
    transition: opacity 0s linear;
    display: inline-flex; align-items: center; justify-content: center;
  }
  /* Disable hover animation for room labels */
  .room-label:hover { 
    transform: translate(-50%, -50%);
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
  }
  .room-label.selected { background: #007acc; color: white; }
  /* External edit button for room labels */
  .room-edit-btn {
    position: absolute;
    transform: translate(-50%, -50%);
    z-index: 60;
    pointer-events: auto;
    min-width: 44px; height: 24px;
    padding: 0 8px;
    border-radius: 12px;
    border: none; /* remove 1px keyline */
    background: #ffffff;
    color: #007acc;
    font-size: 10px; font-weight: 600; line-height: 24px; text-align: center;
    box-shadow: 0 4px 14px rgba(0,0,0,0.2);
    cursor: pointer;
    /* Keep in lockstep with JS-driven fade */
    transition: opacity 0s linear;
  }
  .room-edit-btn:hover { filter: brightness(0.97); box-shadow: 0 6px 18px rgba(0,0,0,0.25); }
  /* Improve hover contrast: white text on brand background */
  .room-edit-btn:hover {
    background: #007acc;
    color: #ffffff;
    filter: none;
    box-shadow: 0 6px 18px rgba(0,0,0,0.25);
    /* no border */
  }
  .room-edit-btn:active { transform: translate(-50%, -50%) scale(0.96); }
  /* Roof rotate button: match stairs 360 handle (violet circle, white border/text) */
  .roof-rotate-btn {
    position: absolute;
    z-index: 60;
    pointer-events: auto;
    width: 32px; height: 32px; text-align: center;
    display: flex; align-items: center; justify-content: center;
    border-radius: 16px; border: 2px solid rgba(255,255,255,0.9);
    background: #8b5cf6; color: #ffffff; font-weight: 700; font-size: 12px;
    box-shadow: none;
    cursor: pointer;
    transition: opacity 0s linear, transform 0.06s ease, background-color 0.15s ease, color 0.15s ease, border-color 0.15s ease;
  }
  .roof-rotate-btn:hover {
    background: #7c3aed; /* slightly darker violet on hover */
    color: #ffffff;
    border-color: rgba(255,255,255,0.95);
    box-shadow: none;
  }
  .roof-rotate-btn:active { transform: scale(0.96); }
  .label-edit-btn {
    z-index: 60; /* above labels */
    border: 1px solid rgba(0,0,0,0.15);
    background: #fff;
    color: #333;
    width: 22px; height: 22px; line-height: 20px; text-align: center;
    border-radius: 11px; font-size: 12px; font-weight: 700; cursor: pointer;
    box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  }
  .label-edit-btn:hover { filter: brightness(0.95); }
  
  #info-modal, #pricing-modal {
    display: none; position: fixed; top: 0; left: 0;
    width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 200;
  }
  
  #info-content, #pricing-content {
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
    background: white; padding: 30px; border-radius: 12px; max-width: 700px;
    width: 700px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.3);
  }
  
  #info-content h2, #pricing-content h2 {
    margin: 0 0 20px 0; color: #333; font-size: 24px;
  }
  
  #info-content p, #pricing-content p {
    margin: 0 0 15px 0; line-height: 1.6; color: #555;
  }
  
  #info-content ul, #pricing-content ul {
    margin: 0 0 15px 20px; color: #555;
  }
  
  #info-content li, #pricing-content li { margin-bottom: 8px; }
  
  .pricing-section {
    margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #eee;
  }
  
  .pricing-section h3 { margin: 0 0 10px 0; color: #333; font-size: 16px; }
  
  .pricing-item {
    display: flex; justify-content: space-between; margin: 5px 0; padding: 2px 0;
  }
  
  .pricing-item-name { color: #666; }
  .pricing-item-cost { color: #333; font-weight: 600; }
  
  .total-section {
    border-bottom: none; background: #f8f9fa; padding: 15px; border-radius: 8px;
  }
  
  .total-section .pricing-item { font-size: 16px; font-weight: 700; }
  
  .close-button {
    position: absolute; top: 15px; right: 20px; background: none; border: none;
    font-size: 24px; cursor: pointer; color: #999;
    transition: color 0.2s, transform 0.1s;
  }
  .close-button:hover {
    color: #007acc;
    transform: scale(1.1);
  }

  /* Room palette modal */
  #room-palette-modal { position: fixed; inset: 0; display: none; z-index: 9999; align-items: center; justify-content: center; }
  #room-palette-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 1; }
  #room-palette-content { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 95vw; height: 95vh; background: #fff; border-radius: 24px; border: 1px solid rgba(0,0,0,0.08); box-shadow: 0 14px 50px rgba(0,0,0,0.28); display: grid; grid-template-columns: minmax(420px, calc(50% + 200px)) minmax(360px, calc(50% - 200px)); overflow: hidden; z-index: 2; }
  #room-palette-content .close-button { z-index: 2; }
  #room-palette-left { padding: 20px 20px 28px 20px; border-right: 1px solid #eee; display: flex; flex-direction: column; gap: 12px; min-height: 0; }
  #room-palette-right { padding: 20px; display: flex; flex-direction: column; align-items: center; min-height: 0; }
  #room-palette-right > h3 { margin: 0 0 8px 0; text-align: center; align-self: center; }
  #palette-list { margin-top: 10px; overflow: auto; border: 1px solid #eee; border-radius: 8px; padding: 12px; gap: 12px; display: grid; grid-template-columns: 1fr; width: 100%; max-width: 560px; margin-left: auto; margin-right: auto; justify-items: stretch; flex: 1 1 auto; min-height: 0; }
  .palette-item { border: 1px solid #ddd; border-radius: 8px; padding: 12px; cursor: pointer; display: grid; grid-template-columns: 110px 1fr; gap: 8px; align-items: center; transition: box-shadow 0.2s, transform 0.1s ease; background: #fff; }
  .palette-item:hover { box-shadow: 0 4px 16px rgba(0,0,0,0.12); }
  .palette-item:active { transform: scale(0.98); }
  .palette-thumb { width: 110px; height: 84px; border: 1px solid #eee; border-radius: 6px; background: repeating-linear-gradient(45deg, #fafafa, #fafafa 10px, #f3f3f3 10px, #f3f3f3 20px); display: flex; align-items: center; justify-content: center; }
  .palette-thumb-canvas { width: 100%; height: 100%; display: block; }
  .palette-name { font-size: 14px; font-weight: 600; color: #333; }
  .palette-dims { font-size: 12px; color: #666; margin-top: 2px; }
  .palette-desc { font-size: 12px; color: #7a7a7a; margin-top: 2px; }

  /* Fixed 500x500 frame for the room preview */
  #room-palette-left h3 { align-self: center; text-align: center; margin-bottom: 6px; }
  #room-preview-canvas { flex: 1 1 auto; width: 100%; border: 1px solid #e6e8eb; border-radius: 8px; background: #ffffff; box-shadow: inset 0 1px 2px rgba(0,0,0,0.03); cursor: grab; min-height: 0; }
  #room-preview-canvas:active { cursor: grabbing; }

  /* Reset Confirmation Modal */
  #reset-confirmation-modal.hidden { display: none; }
  #reset-confirmation-modal .modal-buttons button:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 16px rgba(0,0,0,0.2);
  }
  #reset-confirmation-modal .modal-buttons button:active {
    transform: translateY(0);
  }
  #reset-confirm-btn:hover {
    background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%) !important;
  }
  @keyframes modalFadeIn {
    from {
      opacity: 0;
      transform: scale(0.95);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }
  #reset-confirmation-modal .modal-card {
    animation: modalFadeIn 0.3s ease;
  }